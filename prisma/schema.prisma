datasource db {
  provider = "mongodb"
  url      = env("DB_URI")
}

generator client {
  provider = "prisma-client-js"
}

enum Role {
  ADMIN
  USER
}

model User {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name           String?
  email          String?         @unique
  emailVerified  DateTime?
  image          String?
  password       String?
  accounts       Account[]
  sessions       Session[]
  authenticators Authenticator[]
  role           Role            @default(USER)

  activities         UserActivity[]
  userSessions       UserSession[]
  searchHistory      SearchHistory[]
  interactions       UserInteraction[] @relation("InteractingUser")
  notifications      Notification[]
  targetInteractions UserInteraction[] @relation("TargetUser")
}

model Account {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String @db.ObjectId

  type                     String
  provider                 String
  providerAccountId        String
  refresh_token            String? @db.String
  refresh_token_expires_in Int?
  access_token             String? @db.String
  expires_at               Int?
  token_type               String?
  scope                    String?
  id_token                 String? @db.String
  session_state            String?

  @@unique([provider, providerAccountId])
}

model Session {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sessionToken String   @unique
  expires      DateTime

  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  identifier String
  token      String
  expires    DateTime

  @@unique([identifier, token])
}

model Authenticator {
  credentialID         String  @id @map("_id")
  userId               String  @db.ObjectId
  providerAccountId    String
  credentialPublicKey  String
  counter              Int
  credentialDeviceType String
  credentialBackedUp   Boolean
  transports           String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, credentialID])
}

model UserActivity {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id])
  userId String @db.ObjectId

  activityType ActivityType

  targetId String? @db.ObjectId

  metadata Json?
}

enum ActivityType {
  LOGIN
  LOGOUT
  VIEW_PROFILE
  EDIT_PROFILE
  CREATE_POST
  EDIT_POST
  DELETE_POST
  LIKE_POST
  UNLIKE_POST
  COMMENT
  DELETE_COMMENT
  FOLLOW
  UNFOLLOW
  SEARCH
  SHARE_POST
  BLOCK_USER
  UNBLOCK_USER
}

model UserSession {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id])
  userId String @db.ObjectId

  startTime DateTime  @default(now())
  endTime   DateTime?
  device    String?
  ipAddress String?
  location  String?
}

model SearchHistory {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id])
  userId String @db.ObjectId

  query String
}

model UserInteraction {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User   @relation("InteractingUser", fields: [userId], references: [id])
  userId String @db.ObjectId

  targetUser   User   @relation("TargetUser", fields: [targetUserId], references: [id])
  targetUserId String @db.ObjectId

  interactionType InteractionType
}

enum InteractionType {
  PROFILE_VIEW
  MESSAGE_SENT
  FOLLOW
  UNFOLLOW
}

model FeatureFlag {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name    String  @unique
  enabled Boolean
}

model Notification {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id])
  userId String @db.ObjectId

  type    NotificationType
  content String
  isRead  Boolean          @default(false)
}

enum NotificationType {
  LIKE
  COMMENT
  FOLLOW
  MENTION
}
